<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢—Ä–µ–Ω–∞–∂–µ—Ä —Ç–∞–±–ª–∏—Ü—ã —É–º–Ω–æ–∂–µ–Ω–∏—è</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Comic Sans MS", cursive, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #6e8efb, #a777e3);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        width: 90%;
        max-width: 600px;
        padding: 30px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .title-group {
        margin-bottom: 20px;
      }

      h1 {
        color: #ff6b6b;
        margin-bottom: 10px;
        font-size: 2.2rem;
        text-shadow: 2px 2px 0px #ffd166;
      }

      .game-screen,
      .result-screen,
      .name-screen,
      .records-screen {
        display: none;
      }

      .active {
        display: block;
      }

      .problem {
        font-size: 2.5rem;
        margin: 25px 0;
        color: #118ab2;
      }

      .timer {
        font-size: 1.5rem;
        color: #ff6b6b;
        margin: 10px 0;
      }

      .answer-input {
        width: 100%;
        padding: 15px;
        font-size: 1.5rem;
        text-align: center;
        border: 3px solid #06d6a0;
        border-radius: 10px;
        margin-bottom: 20px;
        outline: none;
      }

      .answer-input:focus {
        border-color: #118ab2;
        box-shadow: 0 0 10px rgba(17, 138, 178, 0.5);
      }

      .btn {
        background-color: #06d6a0;
        color: white;
        border: none;
        padding: 12px 25px;
        font-size: 1.2rem;
        border-radius: 50px;
        cursor: pointer;
        margin: 10px 5px;
        transition: all 0.3s;
      }

      .btn:hover {
        background-color: #05c48f;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .btn:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn-check {
        background-color: #118ab2;
      }

      .btn-check:hover {
        background-color: #0d7a9c;
      }

      .btn-new {
        background-color: #ff6b6b;
      }

      .btn-new:hover {
        background-color: #f45c5c;
      }

      .btn-save {
        background-color: #ffd166;
        color: #333;
      }

      .btn-save:hover {
        background-color: #f9c74f;
      }

      .feedback {
        font-size: 1.5rem;
        margin: 20px 0;
        min-height: 70px;
      }

      .correct {
        color: #06d6a0;
      }

      .incorrect {
        color: #ff6b6b;
      }

      .score {
        font-size: 1.3rem;
        margin: 15px 0;
        color: #118ab2;
      }

      .result-message {
        font-size: 1.8rem;
        margin: 20px 0;
        color: #118ab2;
      }

      .progress-bar {
        height: 15px;
        background-color: #e9ecef;
        border-radius: 10px;
        margin: 20px 0;
        overflow: hidden;
      }

      .progress {
        height: 100%;
        background-color: #06d6a0;
        width: 0%;
        transition: width 0.5s;
      }

      .settings {
        margin: 20px 0;
        text-align: left;
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
      }

      .settings h3 {
        color: #ff6b6b;
        margin-bottom: 10px;
      }

      .number-range {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin: 10px 0;
      }

      .number-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid #118ab2;
        background-color: white;
        color: #118ab2;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .number-btn.selected {
        background-color: #118ab2;
        color: white;
      }

      .name-input {
        width: 100%;
        padding: 15px;
        font-size: 1.2rem;
        text-align: center;
        border: 3px solid #06d6a0;
        border-radius: 10px;
        margin: 20px 0;
        outline: none;
      }

      .records-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      .records-table th,
      .records-table td {
        padding: 10px;
        border: 1px solid #ddd;
      }

      .records-table th {
        background-color: #118ab2;
        color: white;
      }

      .records-table tr:nth-child(even) {
        background-color: #f2f2f2;
      }

      .record-highlight {
        background-color: #ffd166 !important;
        font-weight: bold;
      }

      .firework {
        position: absolute;
        width: 5px;
        height: 5px;
        border-radius: 50%;
        pointer-events: none;
        opacity: 0;
      }

      .champion-message {
        font-size: 1.5rem;
        color: #ff6b6b;
        margin: 15px 0;
        font-weight: bold;
      }

      .motivation-message {
        font-size: 1.2rem;
        color: #118ab2;
        margin: 15px 0;
        font-style: italic;
      }

      .firebase-loading {
        font-size: 1rem;
        color: #118ab2;
        margin: 10px 0;
      }

      .firebase-error {
        color: #ff6b6b;
        font-size: 0.9rem;
        margin: 10px 0;
      }

      @keyframes celebrate {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
        }
      }

      .celebrate {
        animation: celebrate 0.5s ease;
      }

      @keyframes fireworks {
        0% {
          transform: translate(0, 0) scale(0.5);
          opacity: 1;
        }
        100% {
          transform: translate(var(--tx), var(--ty)) scale(2);
          opacity: 0;
        }
      }

      @media (max-width: 500px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 1.8rem;
        }

        .problem {
          font-size: 2rem;
        }

        .btn {
          padding: 10px 20px;
          font-size: 1rem;
        }

        .champion-message,
        .motivation-message {
          font-size: 1rem;
        }
      }
    </style>
    <!-- –î–æ–±–∞–≤–ª—è–µ–º Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="title-group">
        <h1>üöÄ –¢—Ä–µ–Ω–∞–∂–µ—Ä üöÄ</h1>
        <h1>—Ç–∞–±–ª–∏—Ü—ã —É–º–Ω–æ–∂–µ–Ω–∏—è</h1>
      </div>

      <div id="name-screen" class="name-screen active">
        <div class="settings">
          <h3>–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç, —á–µ–º–ø–∏–æ–Ω?</h3>
          <input
            type="text"
            id="player-name"
            class="name-input"
            placeholder="–í–≤–µ–¥–∏ —Å–≤–æ—ë –∏–º—è"
            maxlength="15"
          />
          <h3>–í—ã–±–µ—Ä–∏ —á–∏—Å–ª–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–æ—Ç 2 –¥–æ 9):</h3>
          <div class="number-range">
            <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —á–∏—Å–µ–ª –æ—Ç 2 –¥–æ 9 -->
          </div>
        </div>
        <button id="start-btn" class="btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        <button id="show-records-btn" class="btn">–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</button>
        <div id="firebase-status" class="firebase-loading">
          –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤...
        </div>
        <div
          id="firebase-error"
          class="firebase-error"
          style="display: none"
        ></div>
      </div>

      <div id="game-screen" class="game-screen">
        <div class="timer">–í—Ä–µ–º—è: <span id="timer">00:00</span></div>
        <div class="progress-bar">
          <div id="progress" class="progress"></div>
        </div>
        <div class="score">–°—á–µ—Ç: <span id="score">0</span> –∏–∑ 10</div>
        <div id="problem" class="problem">7 √ó 8 = ?</div>
        <input
          type="number"
          id="answer-input"
          class="answer-input"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç"
        />
        <div id="feedback" class="feedback"></div>
        <button id="check-btn" class="btn btn-check">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <button id="new-game-btn" class="btn btn-new">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
      </div>

      <div id="result-screen" class="result-screen">
        <div class="result-message" id="result-message">
          –û—Ç–ª–∏—á–Ω–æ –ø–æ—Ä–∞–±–æ—Ç–∞–Ω–æ! üéâ
        </div>
        <div class="score">
          –¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="final-score">0</span> –∏–∑ 10
        </div>
        <div class="timer">
          –ó–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è: <span id="final-time">00:00</span>
        </div>

        <div
          id="champion-message"
          class="champion-message"
          style="display: none"
        ></div>
        <div
          id="motivation-message"
          class="motivation-message"
          style="display: none"
        ></div>

        <div id="save-result-container" style="display: none">
          <button id="save-result-btn" class="btn btn-save">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          </button>
        </div>

        <button id="restart-btn" class="btn">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        <button id="to-records-btn" class="btn">–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</button>
      </div>

      <div id="records-screen" class="records-screen">
        <h2>–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</h2>
        <table class="records-table">
          <thead>
            <tr>
              <th>–ú–µ—Å—Ç–æ</th>
              <th>–ò–º—è</th>
              <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
              <th>–í—Ä–µ–º—è</th>
            </tr>
          </thead>
          <tbody id="records-body">
            <!-- –ó–∞–ø–∏—Å–∏ —Ä–µ–∫–æ—Ä–¥–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å –ø–æ–º–æ—â—å—é JS -->
          </tbody>
        </table>
        <button id="back-to-menu-btn" class="btn">–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
      </div>
    </div>

    <script>
      // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase - –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –≤–∞—à—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
      const firebaseConfig = {
        apiKey: "AIzaSyAZQ9j8OTEYTpCEQ4dAY_7tQLscE-LaVVk",
        authDomain: "multiplication-table-tra-4724b.firebaseapp.com",
        projectId: "multiplication-table-tra-4724b",
        storageBucket: "multiplication-table-tra-4724b.firebasestorage.app",
        messagingSenderId: "1084216835885",
        appId: "1:1084216835885:web:410cb696b2c4ff9df99da4",
      };

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      document.addEventListener("DOMContentLoaded", function () {
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const nameScreen = document.getElementById("name-screen");
        const gameScreen = document.getElementById("game-screen");
        const resultScreen = document.getElementById("result-screen");
        const recordsScreen = document.getElementById("records-screen");
        const startBtn = document.getElementById("start-btn");
        const checkBtn = document.getElementById("check-btn");
        const newGameBtn = document.getElementById("new-game-btn");
        const restartBtn = document.getElementById("restart-btn");
        const saveResultBtn = document.getElementById("save-result-btn");
        const saveResultContainer = document.getElementById(
          "save-result-container"
        );
        const showRecordsBtn = document.getElementById("show-records-btn");
        const toRecordsBtn = document.getElementById("to-records-btn");
        const backToMenuBtn = document.getElementById("back-to-menu-btn");
        const problemElement = document.getElementById("problem");
        const answerInput = document.getElementById("answer-input");
        const feedbackElement = document.getElementById("feedback");
        const scoreElement = document.getElementById("score");
        const finalScoreElement = document.getElementById("final-score");
        const resultMessageElement = document.getElementById("result-message");
        const championMessageElement =
          document.getElementById("champion-message");
        const motivationMessageElement =
          document.getElementById("motivation-message");
        const progressElement = document.getElementById("progress");
        const timerElement = document.getElementById("timer");
        const finalTimeElement = document.getElementById("final-time");
        const playerNameInput = document.getElementById("player-name");
        const recordsBody = document.getElementById("records-body");
        const firebaseStatus = document.getElementById("firebase-status");
        const firebaseError = document.getElementById("firebase-error");

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let selectedNumbers = [];
        let currentProblem = {};
        let score = 0;
        let totalProblems = 10;
        let problemsSolved = 0;
        let gameTime = 0;
        let timerInterval = null;
        let playerName = "";
        let isChecking = false;
        let isNewChampion = false;
        let isFirebaseConnected = false;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Firebase
        function checkFirebaseConnection() {
          // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
          try {
            // –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –∫ Firestore
            db.collection("records")
              .limit(1)
              .get()
              .then(() => {
                isFirebaseConnected = true;
                firebaseStatus.textContent = "–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞!";
                firebaseStatus.style.color = "#06d6a0";
                firebaseError.style.display = "none";
              })
              .catch((error) => {
                console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase:", error);
                isFirebaseConnected = false;
                firebaseStatus.textContent =
                  "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤.";
                firebaseStatus.style.color = "#ff6b6b";
                firebaseError.textContent = `–û—à–∏–±–∫–∞: ${error.message}. –†–µ–∫–æ—Ä–¥—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.`;
                firebaseError.style.display = "block";
              });
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
            isFirebaseConnected = false;
            firebaseStatus.textContent = "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase.";
            firebaseStatus.style.color = "#ff6b6b";
            firebaseError.textContent = `–û—à–∏–±–∫–∞: ${error.message}. –†–µ–∫–æ—Ä–¥—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.`;
            firebaseError.style.display = "block";
          }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkFirebaseConnection();

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —á–∏—Å–µ–ª –æ—Ç 2 –¥–æ 9
        const numberRangeContainer = document.querySelector(".number-range");
        for (let i = 2; i <= 9; i++) {
          const button = document.createElement("button");
          button.className = "number-btn";
          button.textContent = i;
          button.dataset.number = i;

          button.addEventListener("click", function () {
            this.classList.toggle("selected");
            const number = parseInt(this.dataset.number);

            if (selectedNumbers.includes(number)) {
              selectedNumbers = selectedNumbers.filter((n) => n !== number);
            } else {
              selectedNumbers.push(number);
            }
          });

          numberRangeContainer.appendChild(button);
        }

        // –ù–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        selectedNumbers = [2, 3, 4];

        // –í—ã–¥–µ–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.querySelectorAll(".number-btn").forEach((btn) => {
          if ([2, 3, 4].includes(parseInt(btn.dataset.number))) {
            btn.classList.add("selected");
          }
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –∑–≤—É–∫–∞–º–∏
        function playCorrectSound() {
          const context = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = context.createOscillator();
          const gainNode = context.createGain();

          oscillator.type = "sine";
          oscillator.frequency.setValueAtTime(880, context.currentTime);
          oscillator.frequency.setValueAtTime(
            1046.5,
            context.currentTime + 0.1
          );

          gainNode.gain.setValueAtTime(0.5, context.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            context.currentTime + 0.3
          );

          oscillator.connect(gainNode);
          gainNode.connect(context.destination);

          oscillator.start();
          oscillator.stop(context.currentTime + 0.3);
        }

        function playWrongSound() {
          const context = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = context.createOscillator();
          const gainNode = context.createGain();

          oscillator.type = "sawtooth";
          oscillator.frequency.setValueAtTime(220, context.currentTime);
          oscillator.frequency.setValueAtTime(196, context.currentTime + 0.1);

          gainNode.gain.setValueAtTime(0.5, context.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            context.currentTime + 0.5
          );

          oscillator.connect(gainNode);
          gainNode.connect(context.destination);

          oscillator.start();
          oscillator.stop(context.currentTime + 0.5);
        }

        function playFireworkSound() {
          const context = new (window.AudioContext ||
            window.webkitAudioContext)();

          for (let i = 0; i < 5; i++) {
            const oscillator = context.createOscillator();
            const gainNode = context.createGain();

            oscillator.type = "sine";
            oscillator.frequency.setValueAtTime(
              300 + i * 100,
              context.currentTime + i * 0.1
            );

            gainNode.gain.setValueAtTime(0.7, context.currentTime + i * 0.1);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              context.currentTime + i * 0.1 + 0.5
            );

            oscillator.connect(gainNode);
            gainNode.connect(context.destination);

            oscillator.start(context.currentTime + i * 0.1);
            oscillator.stop(context.currentTime + i * 0.1 + 0.5);
          }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ –∏–∑ Firebase –∏–ª–∏ localStorage
        async function loadRecords() {
          if (!isFirebaseConnected) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º localStorage, –µ—Å–ª–∏ Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
            const records =
              JSON.parse(localStorage.getItem("multiplicationRecords")) || [];
            console.log("–ó–∞–≥—Ä—É–∂–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏:", records);
            return records;
          }

          try {
            const snapshot = await db
              .collection("records")
              .orderBy("score", "desc")
              .orderBy("time", "asc")
              .limit(10)
              .get();

            const records = [];
            snapshot.forEach((doc) => {
              records.push({ id: doc.id, ...doc.data() });
            });

            console.log("–ó–∞–≥—Ä—É–∂–µ–Ω—ã –∑–∞–ø–∏—Å–∏ –∏–∑ Firebase:", records);
            return records;
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ—Ä–¥–æ–≤:", error);
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
            return (
              JSON.parse(localStorage.getItem("multiplicationRecords")) || []
            );
          }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–æ–≤ –≤ Firebase –∏–ª–∏ localStorage
        async function saveRecord() {
          const recordData = {
            name: playerName,
            score: score,
            time: gameTime,
            timestamp: new Date(),
          };

          if (!isFirebaseConnected) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º localStorage, –µ—Å–ª–∏ Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
            const records =
              JSON.parse(localStorage.getItem("multiplicationRecords")) || [];
            records.push(recordData);
            localStorage.setItem(
              "multiplicationRecords",
              JSON.stringify(records)
            );
            return false;
          }

          try {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
            await db.collection("records").add(recordData);
            return true;
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞:", error);
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
            const records =
              JSON.parse(localStorage.getItem("multiplicationRecords")) || [];
            records.push(recordData);
            localStorage.setItem(
              "multiplicationRecords",
              JSON.stringify(records)
            );
            return false;
          }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        async function getBestRecord() {
          const records = await loadRecords();
          if (records.length === 0) return null;

          // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–ø–∏—Å–∏: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—á–∫–æ–≤, –∑–∞—Ç–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏
          const sortedRecords = records.sort((a, b) => {
            if (b.score !== a.score) {
              return b.score - a.score;
            }
            return a.time - b.time;
          });

          return sortedRecords[0];
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ–º–ø–∏–æ–Ω—Å–∫–∏–º
        async function checkIfChampion() {
          const bestRecord = await getBestRecord();

          // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –∏–ª–∏ —Ç–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ª—É—á—à–µ
          if (
            !bestRecord ||
            (score === 10 &&
              (gameTime < bestRecord.time || bestRecord.score < 10))
          ) {
            isNewChampion = true;
            return true;
          }

          isNewChampion = false;
          return false;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤
        async function showRecords() {
          const records = await loadRecords();
          recordsBody.innerHTML = "";

          if (records.length === 0) {
            recordsBody.innerHTML =
              '<tr><td colspan="4">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤!</td></tr>';
            return;
          }

          // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–ø–∏—Å–∏: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—á–∫–æ–≤, –∑–∞—Ç–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏
          const sortedRecords = records.sort((a, b) => {
            if (b.score !== a.score) {
              return b.score - a.score;
            }
            return a.time - b.time;
          });

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ø-5
          const topRecords = sortedRecords.slice(0, 5);

          topRecords.forEach((record, index) => {
            const row = document.createElement("tr");

            if (index === 0) {
              row.classList.add("record-highlight");
            }

            const placeCell = document.createElement("td");
            placeCell.textContent = index + 1;

            const nameCell = document.createElement("td");
            nameCell.textContent = record.name;

            const scoreCell = document.createElement("td");
            scoreCell.textContent = `${record.score}/10`;

            const timeCell = document.createElement("td");
            timeCell.textContent = formatTime(record.time);

            row.appendChild(placeCell);
            row.appendChild(nameCell);
            row.appendChild(scoreCell);
            row.appendChild(timeCell);

            recordsBody.appendChild(row);
          });
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–º:—Å—Å
        function formatTime(seconds) {
          const mins = Math.floor(seconds / 60);
          const secs = seconds % 60;
          return `${mins
            .toString()
            .padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
        }

        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        function startTimer() {
          gameTime = 0;
          timerElement.textContent = formatTime(gameTime);

          if (timerInterval) {
            clearInterval(timerInterval);
          }

          timerInterval = setInterval(() => {
            gameTime++;
            timerElement.textContent = formatTime(gameTime);
          }, 1000);
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞
        function stopTimer() {
          if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
          }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∞
        function createFireworks() {
          const container = document.querySelector(".container");
          const colors = [
            "#ff6b6b",
            "#06d6a0",
            "#118ab2",
            "#ffd166",
            "#a777e3",
          ];

          for (let i = 0; i < 50; i++) {
            const firework = document.createElement("div");
            firework.className = "firework";
            firework.style.backgroundColor =
              colors[Math.floor(Math.random() * colors.length)];
            firework.style.left = "50%";
            firework.style.top = "50%";

            const angle = Math.random() * Math.PI * 2;
            const distance = 100 + Math.random() * 200;
            const tx = Math.cos(angle) * distance;
            const ty = Math.sin(angle) * distance;

            firework.style.setProperty("--tx", `${tx}px`);
            firework.style.setProperty("--ty", `${ty}px`);

            firework.style.animation = `fireworks 1s ease-out forwards`;

            container.appendChild(firework);

            // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
              firework.remove();
            }, 1000);
          }

          // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∞
          playFireworkSound();
        }

        // –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
        startBtn.addEventListener("click", function () {
          playerName = playerNameInput.value.trim() || "–ò–≥—Ä–æ–∫";

          if (selectedNumbers.length === 0) {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —á–∏—Å–ª–æ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!");
            return;
          }

          nameScreen.classList.remove("active");
          gameScreen.classList.add("active");

          score = 0;
          problemsSolved = 0;
          scoreElement.textContent = score;
          progressElement.style.width = "0%";
          feedbackElement.textContent = "";
          answerInput.value = "";

          startTimer();
          generateProblem();
          answerInput.focus();
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤
        showRecordsBtn.addEventListener("click", function () {
          nameScreen.classList.remove("active");
          recordsScreen.classList.add("active");
          showRecords();
        });

        // –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤
        backToMenuBtn.addEventListener("click", function () {
          recordsScreen.classList.remove("active");
          nameScreen.classList.add("active");
        });

        // –ö–Ω–æ–ø–∫–∞ "–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤" –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        toRecordsBtn.addEventListener("click", function () {
          resultScreen.classList.remove("active");
          recordsScreen.classList.add("active");
          showRecords();
        });

        // –ù–æ–≤–∞—è –∏–≥—Ä—ã
        newGameBtn.addEventListener("click", function () {
          gameScreen.classList.remove("active");
          nameScreen.classList.add("active");
          stopTimer();
        });

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        restartBtn.addEventListener("click", function () {
          resultScreen.classList.remove("active");
          nameScreen.classList.add("active");
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        saveResultBtn.addEventListener("click", async function () {
          const success = await saveRecord();

          if (success && isNewChampion) {
            championMessageElement.textContent =
              "–¢—ã –Ω–æ–≤—ã–π —á–µ–º–ø–∏–æ–Ω! üèÜ –¢–≤–æ—ë –∏–º—è —Ç–µ–ø–µ—Ä—å –≤ —Ç–∞–±–ª–∏—Ü–µ —Ä–µ–∫–æ—Ä–¥–æ–≤!";
          } else if (success) {
            championMessageElement.textContent = "–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω! üëç";
          } else {
            championMessageElement.textContent =
              "–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤.";
          }

          championMessageElement.style.display = "block";
          saveResultContainer.style.display = "none";
        });

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç
        checkBtn.addEventListener("click", checkAnswer);

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter
        answerInput.addEventListener("keyup", function (event) {
          if (event.key === "Enter" && !isChecking) {
            checkAnswer();
          }
        });

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ—Ä–∞
        function generateProblem() {
          if (problemsSolved >= totalProblems) {
            endGame();
            return;
          }

          const num1 =
            selectedNumbers[Math.floor(Math.random() * selectedNumbers.length)];
          const num2 = Math.floor(Math.random() * 8) + 2; // –ß–∏—Å–ª–∞ –æ—Ç 2 –¥–æ 9

          currentProblem = {
            num1: num1,
            num2: num2,
            answer: num1 * num2,
          };

          problemElement.textContent = `${num1} √ó ${num2} = ?`;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
        function checkAnswer() {
          if (isChecking || !answerInput.value) return;

          isChecking = true;
          checkBtn.disabled = true;

          const userAnswer = parseInt(answerInput.value);

          if (userAnswer === currentProblem.answer) {
            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
            feedbackElement.textContent = "–í–µ—Ä–Ω–æ! üëç";
            feedbackElement.className = "feedback correct";
            score++;
            scoreElement.textContent = score;
            problemElement.classList.add("celebrate");

            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
            playCorrectSound();

            setTimeout(() => {
              problemElement.classList.remove("celebrate");
            }, 500);
          } else {
            // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
            feedbackElement.textContent = `–ù–µ–≤–µ—Ä–Ω–æ üò¢ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${currentProblem.answer}`;
            feedbackElement.className = "feedback incorrect";

            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
            playWrongSound();
          }

          problemsSolved++;
          progressElement.style.width = `${
            (problemsSolved / totalProblems) * 100
          }%`;

          // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –≥–æ—Ç–æ–≤–∏–º —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
          setTimeout(() => {
            answerInput.value = "";
            feedbackElement.textContent = "";
            generateProblem();
            answerInput.focus();
            isChecking = false;
            checkBtn.disabled = false;
          }, 1500);
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        async function endGame() {
          stopTimer();
          gameScreen.classList.remove("active");
          resultScreen.classList.add("active");

          finalScoreElement.textContent = score;
          finalTimeElement.textContent = formatTime(gameTime);

          // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
          championMessageElement.style.display = "none";
          motivationMessageElement.style.display = "none";
          saveResultContainer.style.display = "none";

          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–≥—Ä–æ–∫ —á–µ–º–ø–∏–æ–Ω–æ–º
          const isChampion = await checkIfChampion();
          const bestRecord = await getBestRecord();

          if (score === 10) {
            if (isChampion) {
              resultMessageElement.textContent =
                "–ò–¥–µ–∞–ª—å–Ω–æ! –¢—ã –Ω–æ–≤—ã–π —á–µ–º–ø–∏–æ–Ω! üèÜ";
              championMessageElement.textContent =
                "–¢—ã –ø–æ–±–∏–ª –≤—Å–µ —Ä–µ–∫–æ—Ä–¥—ã! –°–æ—Ö—Ä–∞–Ω–∏ —Å–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!";
              championMessageElement.style.display = "block";
              saveResultContainer.style.display = "block";
              createFireworks();
            } else {
              resultMessageElement.textContent = "–ò–¥–µ–∞–ª—å–Ω–æ! –¢—ã –º–æ–ª–æ–¥–µ—Ü! üëç";
              motivationMessageElement.textContent = `–ù–æ —á–µ–º–ø–∏–æ–Ω ${
                bestRecord.name
              } –±—ã–ª –±—ã—Å—Ç—Ä–µ–µ (${formatTime(
                bestRecord.time
              )}). –¢—ã —Å–º–æ–∂–µ—à—å –µ–≥–æ –ø–æ–±–µ–¥–∏—Ç—å!`;
              motivationMessageElement.style.display = "block";
              saveResultContainer.style.display = "block";
            }
          } else if (score >= 7) {
            resultMessageElement.textContent = "–û—Ç–ª–∏—á–Ω–æ –ø–æ—Ä–∞–±–æ—Ç–∞–Ω–æ! üëç";
            if (bestRecord) {
              motivationMessageElement.textContent = `–ß–µ–º–ø–∏–æ–Ω ${
                bestRecord.name
              } –Ω–∞–±—Ä–∞–ª 10/10 –∑–∞ ${formatTime(
                bestRecord.time
              )}. –¢—ã —Å–º–æ–∂–µ—à—å –µ–≥–æ –ø–æ–±–µ–¥–∏—Ç—å!`;
              motivationMessageElement.style.display = "block";
            }
          } else if (score >= 5) {
            resultMessageElement.textContent = "–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! üòä";
            if (bestRecord) {
              motivationMessageElement.textContent = `–ß–µ–º–ø–∏–æ–Ω ${
                bestRecord.name
              } –Ω–∞–±—Ä–∞–ª 10/10 –∑–∞ ${formatTime(
                bestRecord.time
              )}. –ü—Ä–æ–¥–æ–ª–∂–∞–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è!`;
              motivationMessageElement.style.display = "block";
            }
          } else {
            resultMessageElement.textContent =
              "–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑! –¢—ã —Å–º–æ–∂–µ—à—å! üí™";
            if (bestRecord) {
              motivationMessageElement.textContent = `–ß–µ–º–ø–∏–æ–Ω ${
                bestRecord.name
              } –Ω–∞–±—Ä–∞–ª 10/10 –∑–∞ ${formatTime(bestRecord.time)}. –ù–µ —Å–¥–∞–≤–∞–π—Å—è!`;
              motivationMessageElement.style.display = "block";
            }
          }
        }
      });
    </script>
  </body>
</html>
